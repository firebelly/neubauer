{# cardArticle 
    See styles/components/_cards.scss for styling

    @cardName {str}  - base styling hook
    @cardEntry {obj} - entry object
    @cardObj {obj}   - wildcard object for storage
    @cardVariant {str} - styling variant hook
#}
{% macro cardArticle(cardName,cardEntry,cardObj = {},cardVariant = null) %}
{% import 'macros/_utils' as utils %}
{% import 'macros/_dates' as dates %}
{% import 'macros/_assets' as assets %}
{% import 'macros/_controls' as controls %}

{% set entrySection = cardEntry.section|lower %}
{% set cardVariant = cardObj is not null and 'cardVariant' in cardObj|keys ? cardObj['cardVariant'] : null %}
{% set cardImage = cardEntry.cardImage and cardEntry.cardImage.one() is not null ? cardEntry.cardImage : null %}
{% set cardTopics = cardEntry.topicList is not null and cardEntry.topicList|length > 0 ? cardEntry.topicList : null %}
{% set cardDate = cardEntry.dateBlock is not null and cardEntry.dateBlock|length == 1 ? dates.printDate(cardEntry.dateBlock[0]) : null %}
{% set cardUrl = cardEntry.url %}
{% set cardTeam = cardEntry.projectTeam is not null and cardEntry.projectTeam|length > 0 ? cardEntry.projectTeam : null %}

{% set cardAbstract = cardEntry.abstract is not null and cardEntry.abstract != '' ? cardEntry.abstract : 
                (cardEntry.exhibitionAbstract is not null and cardEntry.exhibitionAbstract != '' ? cardEntry.exhibitionAbstract: null) %}

{% set cardBody = cardEntry.summary is not null and cardEntry.summary != '' ? cardEntry.summary :
                (cardEntry.personSummary is not null and cardEntry.personSummary != "" ? cardEntry.personSummary : null) %}

{% set arrowPath = "/spritemap.svg#icon-arrow-right-20" %}
{% set emailPath = "/spritemap.svg#icon-email-20" %}

{# Person vars #}
{% set isBio = (cardName == 'searchBio') %}
{% set isPeopleDirectory = (cardVariant == 'people') %}

<article class="{{ cardName }}{% if cardVariant %} {{ cardName }}--{{ cardVariant }}{% endif %}" data-section="{{ entrySection }}">

    {# Card: Title Top  #}
    <h3 class="{{ cardName }}-title {{ cardName }}-title--top">
        <a href="{{ cardUrl }}">{{ cardEntry.title }}</a>
    </h3>

    {# Card: Image #}
    {% if cardImage %}
    {% set assetName = "#{cardName}-asset" %}
    {% set assetSizes = cardObj is not null and 'assetSizes' in cardObj|keys ? cardObj['assetSizes']|json_decode : null %}
    <picture class="{{ assetName }}">
        {% if assetSizes %}
        {{ assets.assetCard(assetName,cardImage,assetSizes) }}
        {% else %}
        {{ assets.assetCard(assetName,cardImage) }}
        {% endif %}
    </picture>
    {% elseif isBio %}
    <div class="{{ cardName }}-asset--ghost"></div>
    {% endif %}

    <div class="{{ cardName }}-details">
        {# Card: Title  #}
        <h3 class="{{ cardName }}-title {{ cardName }}-title--btm">
            <a href="{{ cardUrl }}">{{ cardEntry.title }}</a>
        </h3>

        {# Card: Person Details #}
        {% if cardEntry.personTitle %}
        <p class="{{ cardName }}-subtitle" data-person-type="{{ cardEntry.personType[0] }}">{{ cardEntry.personTitle }}</p>
        {% endif %}
        {% if cardEntry.personAffiliation %}
        <p class="{{ cardName }}-caption">{{ cardEntry.personAffiliation }}</p>
        {% endif %}

        {# Card: Main Content #}
        {% set showContent = cardObj and 'showContent' in cardObj|keys ? cardObj['showContent'] : true %}
        {% if showContent %}
        {% if cardAbstract %}
        <div class="{{ cardName }}-redactor {{ cardName }}-redactor--abstract">
            {{ cardAbstract|raw }}
        </div>
        {% endif %}

        {% if cardBody %}
        <div class="{{ cardName }}-redactor {{ cardName }}-redactor--body">
            {{ cardBody|raw }}
        </div>
        {% endif %}
        {% endif %}

        {# Card: Team #}
        {% if cardTeam %}
        <div class="{{ cardName }}-team">
            <h3 class="{{ cardName }}-team-title">Project Team:</h3>
            <ul class="{{ cardName }}-team-list">
            {% for person in cardTeam %}
                <li class="{{ cardName }}-team-item">
                    <a 
                        class="{{ cardName }}-team-name"
                        href="{{ person.uri }}">{{ person }}</a>{% if loop.length > 1 and not loop.last %}&#44; &nbsp;{% endif %}
                </li>
            {% endfor %}
            </ul>
        </div>
        {% endif %}

        {# Card: Date #}
        {% if cardDate %}
        <time 
            class="{{ cardName }}-dateblock"
            datetime="">
            {{ cardDate }}
        </time>
        {% endif %}

        {# Card: Topics #}
        {% if cardTopics %}
        {% set isSearch = cardObj is not null and 'isSearch' in cardObj|keys ? cardObj.isSearch : false %}
        {% set activeTags = cardObj is not null and 'activeTags' in cardObj|keys ? cardObj.activeTags : null %}
        {% set activeArr = activeTags ? activeTags|split(',') : [] %}
        <div class="{{ cardName }}-topics{% if cardVariant %} {{ cardName }}-topics--{{ cardVariant }}{% endif %}">
            <h3 class="{{ cardName }}-topics-title">Project Topics:</h3>
            <ul class="{{ cardName }}-topics-list">
            {% for tag in cardTopics %}
            {# If this card lives in the Search directory, handle the topic tags accordingly #}
            {% if isSearch %} 
                {% set filterName,groupSlug,itemSlug,itemName = "#{cardName}-topics","tags",tag.title|slugify,tag.title %}
                {% set isActive = (activeArr|length and (itemSlug in activeArr)) %}
                {{ controls.controlDimensionsItem(filterName,groupSlug,itemSlug,itemName,isActive) }}
            {% else %}
                <li class="{{ cardName }}-topics-item">
                    <a 
                        class="{{ cardName }}-topics-trigger {{ cardName }}-topics-trigger--tag"
                        href="search?tags={{ tag.slug }}">
                        <span class="{{ cardName }}-topics-label {{ cardName }}-topics-label--tag">{{ tag }}</span>
                    </a>
                </li>
            {% endif %}
            {% endfor %}
            </ul>
        </div>
        {% endif %}

        {# Card: Actions #}
        <div class="{{ cardName }}-buttons">
            <a 
                class="{{ cardName }}-action {{ cardName }}-action--{{ isPeopleDirectory ? 'link' : 'ghost' }}"
                href="{{ cardUrl }}"
                title=""
                role="">
                <span class="{{ cardName }}-action-label">{{ isBio ? 'Full Bio' : 'Learn More' }}</span>
                <svg class="{{ cardName }}-action-icon">
                    <use xlink:href="{{ alias('@assetBasePath' ~ arrowPath) }}"></use>
                </svg>
            </a>
            {% if cardEntry.personEmail %}
            <a 
                class="{{ cardName }}-action {{ cardName }}-action--link"
                href="mailto:{{ cardEntry.personEmail }}"
                title=""
                role="">
                <span class="{{ cardName }}-action-label">Email</span>
                <svg class="{{ cardName }}-action-icon">
                    <use xlink:href="{{ alias('@assetBasePath' ~ emailPath) }}"></use>
                </svg>
            </a>
            {% endif %}
        </div>
    </div>
</article>
{% endmacro %}


{# cardFeature
    See styles/components/_cards.scss for styling

    @cardName {str}  - base styling hook
    @cardEntry {obj} - entry object
    @cardObj {obj}   - wildcard object for storage
#}
{% macro cardFeature(cardName,cardEntry,cardObj = {}) %}
{% import 'macros/_assets' as assets %}
{% import 'macros/_dates' as dates %}

{% set cardVariant = cardObj is not null and 'cardVariant' in cardObj|keys ? cardObj['cardVariant'] : null %}
{% set cardLabel = cardObj is not null and 'cardLabel' in cardObj|keys ? cardObj['cardLabel'] : null %}
{% set cardId = cardObj is not null and 'cardId' in cardObj|keys ? cardObj['cardId'] : null %}
{% set cardImage = cardEntry.cardImage and cardEntry.cardImage.one() is not null ? cardEntry.cardImage : null %}
{% set team = cardEntry.projectTeam.all() %}
{% set topics = cardEntry.topicList.all() %}
{% set date = cardEntry.dateBlock is not null and cardEntry.dateBlock|length == 1 ? dates.printDate(cardEntry.dateBlock[0]) : null %}
{% set arrowPath = "/spritemap.svg#icon-arrow-right-20" %}

{# TO DO: abstract this to use for directory cards also #}

<section class="{{ cardName }}{% if cardVariant %} {{ cardName }}--{{ cardVariant }}{% endif %}" id="{{ cardId }}">
    <h2 class="{{ cardName }}-label{% if cardVariant == 'related' %} {{ cardName }}-label--hidden{% endif %}">{{ cardLabel }}</h2>
    <div class="{{ cardName }}-content">
        
        {% if cardImage %}
        {% set assetName = "#{cardName}-asset" %}
        {% set assetSizes = cardObj is not null and 'assetSizes' in cardObj|keys ? cardObj['assetSizes']|json_decode : null %}
        <picture class="{{ assetName }}">
            {% if assetSizes %}
            {{ assets.assetCard(assetName,cardImage,assetSizes) }}
            {% else %}
            {{ assets.assetCard(assetName,cardImage) }}
            {% endif %}
        </picture>
        {% endif %}

        <div class="{{ cardName }}-details">
            {% if cardVariant == 'related' %}
                <h3 class="{{ cardName }}-subtitle">{{ cardLabel }}</h3>
            {% endif %}
            <h3 class="{{ cardName }}-title">{{ cardEntry.title }}</h3>
            
            {% if team|length > 0 %}
            <div class="{{ cardName }}-team">
                <h3 class="{{ cardName }}-team-title">Project Team:</h3>
                <ul class="{{ cardName }}-team-list">
                    {% for member in team %}
                    <li class="{{ cardName }}-team-item">
                        <a href="{{ siteUrl }}{{ member.uri }}">{{ member.title }}</a>{{ loop.last ? '' : ', &nbsp;' }}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            
            {% if topics|length > 0 %}
            <div class="{{ cardName }}-topics{% if cardVariant %} {{ cardName }}-topics--{{ cardVariant }}{% endif %}">
                <h3 class="{{ cardName }}-topics-title">Project Topics:</h3>
                <ul class="{{ cardName }}-topics-list">
                    {% for tag in topics %}
                    <li class="{{ cardName }}-topics-item">
                        <a 
                            class="{{ cardName }}-topics-trigger {{ cardName }}-topics-trigger--tag"
                            href="search?tags={{ tag.slug }}">
                            <span class="{{ cardName }}-topics-label">{{ tag.title }}
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            {% if date %}
            <div class="{{ cardName }}-date">{{ date }}</div>
            {% endif %}

            <div class="{{ cardName }}-buttons">
                <a 
                    class="{{ cardName }}-action {{ cardName }}-action--ghost"
                    href="{{ cardEntry.url }}"
                    title=""
                    role="">
                    <span class="{{ cardName }}-action-label">Learn More</span>
                    <svg class="{{ cardName }}-action-icon">
                        <use xlink:href="{{ alias('@assetBasePath' ~ arrowPath) }}"></use>
                    </svg>
                </a>
            </div>
        </div>
    </div>
</section>
{% endmacro %}

{# cardMini
    See styles/components/_cards.scss for styling

    @cardName {str}  - base styling hook
    @cardEntry {obj} - entry object
    @cardObj {obj}   - wildcard object for storage
    @cardVariant {str} - styling variant hook
#}
{% macro cardMini(cardName,cardEntry,cardObj = {},cardVariant = null) %}
{% import 'macros/_assets' as assets %}

{% set title = cardEntry.cardTitle != '' ? cardEntry.cardTitle : null %}
{% set summary = cardEntry.cardSummary != '' ? cardEntry.cardSummary : null %}
{% set image = cardEntry.cardImage is not null and cardEntry.cardImage|length > 0 ? cardEntry.cardImage : null %}
{% set dnld = cardEntry.downloadLink|length > 0 ? cardEntry.downloadLink.one() : null %}
{% set actionLabel = cardEntry.actionLink.actionText != '' ?  cardEntry.actionLink.actionText : null %}
{% set actionURL = cardEntry.actionLink.actionURL != '' ?  cardEntry.actionLink.actionURL : null %}
{% set arrowPath = "/spritemap.svg#icon-arrow-right-20" %}
{% set dnldPath = "/spritemap.svg#icon-download-20" %}

<article class="{{ cardName }}">

    {% if image %}
    <div class="{{ cardName }}-asset">
        {% set cardName,cardImage = "#{cardName}-asset",image %}
        {% set assetSizes = cardObj is not null and 'assetSizes' in cardObj|keys ? cardObj['assetSizes']|json_decode : null %}
        {% if assetSizes %}
            {{ assets.assetCard(cardName,cardImage,assetSizes) }}
        {% else %}
            {{ assets.assetCard(cardName,cardImage) }}
        {% endif %}
    </div>
    {% endif %}

    {% if title %}
    <h3 class="{{ cardName }}-title">{{ title }}</h3>
    {% endif %}

    {% if summary %}
    <div class="{{ cardName }}-summary">{{ summary }}</div>
    {% endif %}
    {% if dnld %}
    <a
        class="{{ cardName }}-action {{ cardName }}-action--link"
        href="{{ dnld.url }}"
        title=""
        role="">
        <span class="{{ cardName }}-action-label">{{ dnld.title }}</span>
        <svg class="{{ cardName }}-action-icon">
            <use xlink:href="{{ alias('@assetBasePath' ~ dnldPath) }}"></use>
        </svg>
    </a>
    {% endif %}
    {% if actionLabel and actionURL %}
    <a 
        class="{{ cardName }}-action {{ cardName }}-action--link"
        href="{{ actionURL }}"
        title=""
        role="">
        <span class="{{ cardName }}-action-label">{{ actionLabel }}</span>
        <svg class="{{ cardName }}-action-icon">
            <use xlink:href="{{ alias('@assetBasePath' ~ arrowPath) }}"></use>
        </svg>
    </a>
    {% endif %}
</article>
{% endmacro %}